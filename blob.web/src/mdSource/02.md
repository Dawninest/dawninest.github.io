---
title: Objective-C | 内存管理
tag: iOS
date: 2016-02-21
---

## 内存管理 

### 内存管理的原理：

​	保证每个对象在使用时存在内存中，不用的对象最后从内存中清除一个对象的生命周期		

​	对象初始化  -> 执行，使用 -> 释放内存管理只针对继承NSObject的对象，对C数据类型无效 

### **retainCount**引用计数	

1. 每个OC对象都有自己的引用计数器，retainCount	
2. 当对象被创建时，引用计数置为1	
3. retain使对象引用计数加1，并获得对象的所有权	
4. release使对象引用计数减1，并放弃对象的所有权	
5. 当引用计数为0时，对象将被系统销毁 	

```
retainCount:获取对象当前的引用计数	
alloc:返回一个对象，并将其引用计数设置为1，类方法	
retain;将对象的引用计数加1	
release:对象的引用计数减1	
autoreplease:将对象加入自动释放池，对象引用计数滞后减1	
dealloc，不主动调用，需要在类中重写 	
```

在非ARC模式下，进行内存管理	

- 内存管理仅仅使用于对象类型，数据类型无需进行内存管理		
- 使用alloc,new,copy,mutableCopy生成的对象，对象初始引用计数值为1，手动释放内存(堆)	
- 使用便利初始化生成的对象，对象初始引用计数值为1，并且已经设置为自动释放(栈)	
- 使用retain持有的对象，需要保证retain和release次数相等 

### **setter**,**getter**内存管理	

```
- (void)setName:(NSString *)name	{
	if(name != name){
  	[name release];		//释放旧对象，持有新对象			 
  	_name = [name retain];		
  }
} 	
- (NSString *)name	{
	retain _name;	
} 
```

### 自定义初始化	

自定义初始化方法中：	

```
if(self){
	_name = [name retain];	
} 
```

### 集合内存管理：字典，数组	

1. 对象加入集合对象时，＋1	
2. 对象从集合对象中移除，—1	
3. 集合对象的retainCount改变，其中元素的retainCount不变	
4. 集合对象销毁时，其中所有元素release一次 

### 自动释放池**NSAutoreleasePool**	

- 类似于一个容器，所有加入容器中的对象都可以被其管理，容器销毁时，池将会释放(release)所有对象	
- 一个对象可以被多次autorelease	
- 便利初始化的对象默认已经加入当前池中 	

```
NSAutoreleasePool *pool = [[NSAutoreleasePool alloc]init];
```



