---
title: 微信小程序 | 你在B站看番么
tag: 微信小程序
date: 2019-02-21
---

### 小程序名: 你在B站看番么

状态: 1.0已上线, 2.0开发中

从B站Web版拿到的接口记录

通过mid获取B站用户关注的番剧列表

```
https://space.bilibili.com/ajax/Bangumi/getList?mid=10279946&page=4
[{
	brief: "人类遭遇了名为“空间震”的新型灾害。震荡空间、将一切破坏殆尽的这一灾厄，是由于存在于临界的精灵出现这..."
    cover: 	"http://i0.hdslb.com/bfs/bangumi/fd61c0a8680678960446a849f2079e0de09d4290.png"
    evaluate: ""
    favorites: 842317
    is_finish: 0
    last_ep_index: 0
    newest_ep_index: 1
    season_id: "26308"
    share_url: "http://bangumi.bilibili.com/anime/26308/" title: "约会大作战 第三季"
    total_count: 0
},…]
```

通过输入关键字搜索指定用户

```
https://search.bilibili.com/upuser?keyword=Dawninest
res.data.replace(/<script>window.__initial_state__=(.*);\(function/ig,($0,$1)=>{
	this.userData=JSON.parse($1).userData
})
[{
	"rank_offset": 1,
	"usign": "傲娇的iOS Developer",
	"videos": 0,
	"fans": 2,
	"is_upuser": 0,
	"upic": 	"\u002F\u002Fi1.hdslb.com\u002Fbfs\u002Fface\u002F83afeac37a7087aca9efb24f449a04923de708e9.jpg",
	"uname": "Dawninest",
	"official_verify": {"type": 127, "desc": ""},
	"verify_info": "",
	"rank_score": 2,
	"level": 5,
	"gender": 1,
	"hit_columns": ["uname"],
	"mid": 10279946,
	"is_live": 0,
	"room_id": 6738557,
	"res": [],
	"rank_index": 0,
	"type": "bili_user"
},..]
```

新番更新时间表

```
https://bangumi.bilibili.com/web_api/timeline_global
[
	{
		date:  “2-8”,
		date_ts: 1549555200,
		day_of_week: 5,
		is_today: 0,
		seasons:
			[
				{
						cover: "http://i0.hdslb.com/bfs/bangumi/de944b7c9306932d8dd3dcaeaf2eeec8670deec5.png"	
						delay: 0
						ep_id: 259679
						favorites: 1910041
						follow: 0
						is_published: 1
						pub_index: "第6话"
						pub_time: "22:00"
						pub_ts: 1550066400
						season_id: 26284 // 用于跳转的 ssid
						season_status: 13
						square_cover: "http://i0.hdslb.com/bfs/bangumi/f02cf4282f5dec97d96c8b6afc4301f6bb831cc6.jpg"
						title: "盾之勇者成名录"
				},...
			]
	}
]
```

B站番剧排行[追番人数/最高评分/播放数量]

```
eg: 
https://bangumi.bilibili.com/media/web_api/search/result?season_version=-1&area=-1&is_finish=-1&copyright=-1&season_status=-1&season_month=-1&pub_date=-1&style_id=-1&order=4&st=1&sort=0&page=1&season_type=1&pagesize=20

[Get]https://bangumi.bilibili.com/media/web_api/search/result
{
	season_version=-1, // 类型 -1/全部,1/正片,2/剧场版,3/其他 
	area=-1,	// 地区 -1/全部,2/日本,3/美国, 1-51不含2,3 /其他 
	is_finish=-1, // 状态 -1/全部, 1/完结,0/连载
	copyright=-1,// 版权 -1/全部, 3/独家, 1,2,4其他
	season_status=-1,// 付费 -1/全部, 1/免费, 2/付费, 4,6/大会员
	season_month=-1,// 季度 -1/全部, 1/1月, 4/4月, 7/7月, 10/10月
	pub_date=-1,// 时间 -1/全部,   2019/年份数字 或 2010-2014区间 
	style_id=-1,// 风格 

	order=4, //  0/更新时间排行,2/播放数量排行,3/追番人数排行,4/最高评分排行,5/开播时间排行
	st=1, //未知
	sort=0, // 0,正序/ 1,倒序
	page=1, // 当前页码
	season_type=1, // 未知
	pagesize=20, // 当前每页数量
}
返回结果例子:
{
	data: [
		{
			badge: "会员专享"
			badge_type: 0
			cover: "http://i0.hdslb.com/bfs/bangumi/f5d5f51b941c01f8b90b361b412dc75ecc2608d3.png"
			index_show: "全14话"
			is_finish: 1
			link: "https://www.bilibili.com/bangumi/play/ss24588"
			media_id: 102392
			season_id: 24588
			title: "工作细胞"
			order: {
				follow: "596.3万人追番"
				play: "1.4亿次播放"
				pub_date: 1530979200
				pub_real_time: 1530979200
				renewal_time: 1545843600
				score: "9.7分"
				type: "follow"
			}
		},
	…
	],
	page:{
		num: 1
		size: 20
		total: 3096
	}
}
```

番剧详情

```
先得通过season_id拿到media_id
"https://www.bilibili.com/bangumi/play/ss" + seasonId
解析关键字段得到 "https://www.bilibili.com/bangumi/media/" + media_id
返回数据:
{
		actors: “利姆鲁·特恩佩斯特：冈咲美保↵大贤者：丰口惠美↵维鲁德拉·特恩佩斯特…” // 角色声优
		title:"关于我转生变成史莱姆这档事" // 番名
		chn_name: "关于我转生变成史莱姆这档事" // 番名中文
		origin_name:"転生したらスライムだった件" // 番名日文
		copyright: {
			is_finish:0 // 是否完结
			is_started:1 // 是否开始
		}
		cover: "http://i0.hdslb.com/bfs/bangumi/a4c0e0ccc44fe3949a734f546cf5bb07da925bad.png" //  封面
		episode_index: {
			id:250479
			index_show:"连载中, 每周二0:30更新"
			is_new:1
		}
		episodes: { //每一话的数据
			[
				aid:32836144
				cid:57467566
				cover:"http://xxxx/4994e631fef939e7f606c012682a96ce2d3bf7b8.jpg"
				duration:1420002
				ep_id:250460
				episode_status:2
				from:"bangumi"
				index:"1"
				index_title:"暴风龙维鲁德拉"
				mid:928123
				page:1
				pub_real_time:"2018-10-02 00:30:00"
				section_id:34988
				section_type:0
				vid:""
			]
			…
		}
		evaluate: “史莱姆生活，开始了。↵上班族的三上悟在道路上被歹徒给刺杀身…” // 简介
		media_id: “139252” //
		param: {
			season_id:25739
			season_type:1
		}
		publish: {
			is_finish:0
			is_multi:1
			is_started:1
			pub_date:"2018-10-02"
			pub_date_show:"2018年10月2日"
			time_length:24
			total_ep:0
		}
		rating: {
			count:43958 // 评分人数
			score:9.5	// 评分
		}
		staff: “” // STAFF
		stat: {
			danmakus:2232701 // 弹幕总数
			favorites:4299164 // 追番人数
			views:137665521 // 总播放
		}
		style: [ // 类型?标签?
			{
				id:117
				name:"小说改"
			}
			...
		]
}
```

计划后续功能

```
1. B站番剧排行页面
2. 用户关联相关设计
3. 热门番剧推荐
4. 想一个更实用的使用点[番剧更新提示推送?]
```

